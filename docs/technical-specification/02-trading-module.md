# Технічне завдання: Модуль торгівлі

## 1. Огляд

Цей документ описує технічні вимоги до модуля торгівлі в Telegram-боті для Binance. Модуль дозволяє користувачам виконувати спотові ринкові та лімітні ордери (купівля/продаж) через інтерфейс бота.

## 2. Функціональні вимоги

### 2.1. Ініціювання торгової сесії

- Користувач може розпочати торгову сесію за допомогою команди `/trade`.
- Бот повинен запросити у користувача торгову пару (наприклад, ETHUSDT).

### 2.2. Вибір дії та типу ордеру

- Після введення дійсної торгової пари, бот повинен запропонувати користувачеві вибрати дію: "Купити" або "Продати".
- Після вибору дії, бот повинен запропонувати вибрати тип ордеру: "Ринок" або "Ліміт".
- Вибір здійснюється за допомогою інлайн-клавіатури.

### 2.3. Введення ціни (для лімітних ордерів)

- Якщо користувач обрав лімітний ордер, бот повинен запросити у користувача ціну виконання.

### 2.4. Вибір типу суми

- Після вибору типу ордеру (і ціни, якщо потрібно), бот повинен запропонувати користувачеві вибрати спосіб введення суми:
    - **Вручну**: Користувач вводить суму вручну.
    - **Відсоток від балансу**: Користувач вказує відсоток від доступного балансу.
- Вибір здійснюється за допомогою інлайн-клавіатури.

### 2.5. Введення суми

- **При ручному вводі:**
    - Бот повинен запросити у користувача суму в USDT для купівлі або продажу.
- **При вводі відсотка:**
    - Бот повинен запросити у користувача відсоток від балансу (від 1 до 100).

### 2.6. Підтвердження та виконання

- Після введення суми, бот повинен відобразити повідомлення з підтвердженням, що містить наступну інформацію:
    - Торгова пара
    - Дія (Купівля/Продаж)
    - Тип ордеру (Ринок/Ліміт)
    - Ціна (для лімітних ордерів)
    - Сума в USDT
    - (Для продажу) Еквівалентна кількість базового активу
- Для ринкових ордерів, повідомлення повинно містити попередження про можливе прослизання ціни.
- Користувач може підтвердити або скасувати операцію за допомогою інлайн-клавіатури.
- Після підтвердження, бот повинен створити відповідний ордер на Binance.
- Після виконання ордеру, бот повинен надіслати користувачеві повідомлення з інформацією про ордер (ID, символ, статус).

### 2.7. Обробка помилок

- Бот повинен обробляти наступні помилкові ситуації:
    - Невірна торгова пара.
    - Неправильний формат суми, відсотка, або ціни.
    - Сума ордеру менша за мінімально допустиму (`minNotional`).
    - Недостатньо коштів на балансі.
    - Помилки API Binance (бот повинен повертати конкретне повідомлення про помилку від API).

## 3. Нефункціональні вимоги

- **Точність**: Розрахунки кількості та вартості повинні бути точними і відповідати вимогам Binance щодо точності (precision) для кожної торгової пари.
- **Надійність**: Модуль повинен бути надійним і працювати без збоїв.
- **Безпека**: Ключі API та інші конфіденційні дані повинні зберігатися безпечно.

## 4. Технічна реалізація

- **Мова програмування**: Python
- **Бібліотека для Telegram Bot API**: aiogram
- **Взаємодія з Binance API**: кастомний клієнт API
- **Керування станами**: FSM (Finite State Machine) в aiogram